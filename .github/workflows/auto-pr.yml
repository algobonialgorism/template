name: Auto PR Creator
on:
  push:
    branches: [ "main" ] # ë°±ì¤€í—ˆë¸Œê°€ í‘¸ì‹œí•˜ëŠ” ê³³
    paths:
      - "**/*.java"  # ì½”ë“œ íŒŒì¼ì´ ë“¤ì–´ì˜¬ ë•Œë§Œ ë°œë™ (ì–¸ì–´ì— ë§ê²Œ ìˆ˜ì •)
      - "**/*.py"
      - "**/*.cpp"

jobs:
  create-pr-to-archive:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write # PRì„ ë§Œë“¤ ê¶Œí•œ í•„ìš”

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Create Pull Request to Archive
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }} # ê¹ƒí—ˆë¸Œê°€ ê¸°ë³¸ ì œê³µí•˜ëŠ” í† í°
        run: |
          # ì œëª©ì€ ì»¤ë°‹ ë©”ì‹œì§€(ë³´í†µ ë¬¸ì œ ì´ë¦„)ë¥¼ ê·¸ëŒ€ë¡œ ì”ë‹ˆë‹¤
          TITLE=$(git log -1 --pretty=%s)
          
          # main(í˜„ì¬)ì—ì„œ archive(ëª©í‘œ)ë¡œ ê°€ëŠ” PR ìƒì„±
          # ì´ë¯¸ ì—´ë ¤ìˆëŠ” PRì´ ìˆë‹¤ë©´ ì—ëŸ¬ê°€ ë‚˜ëŠ”ë°, '|| true'ë¡œ ë¬´ì‹œí•´ì„œ ì¤‘ë³µ ìƒì„±ì„ ë°©ì§€í•©ë‹ˆë‹¤.
          gh pr create \
            --base archive \
            --head main \
            --title "[í’€ì´ ì œì¶œ] $TITLE" \
            --body "CodeRabbit ë‹˜, ì œ í’€ì´ë¥¼ ì±„ì í•´ì£¼ì„¸ìš”! ğŸ¥•" \
            || echo "PR already exists, updated commits."
