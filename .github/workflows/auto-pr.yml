name: Auto PR Creator

on:
  push:
    branches: [ "main" ]
    paths:
      - "**/**/*.java"

jobs:
  create-pr-to-archive:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Create Pull Request to Archive and Request CodeRabbit Review
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          TITLE=$(git log -1 --pretty=%s)

          gh pr create \
            --base archive \
            --head main \
            --title "[í’€ì´ ì œì¶œ] $TITLE" \
            --body "CodeRabbit ë‹˜, ì œ í’€ì´ë¥¼ ì±„ì í•´ì£¼ì„¸ìš”! ğŸ¥•" || true

          PR_NUMBER=$(gh pr list \
            --base archive \
            --head main \
            --state open \
            --json number \
            --jq '.[0].number')

          if [ -n "$PR_NUMBER" ]; then
            gh pr comment "$PR_NUMBER" --body "@coderabbitai review"
          fi
